--Borrado de tablas

DROP TABLE TASAS;
DROP TABLE MONEDA_X_PAIS;
DROP TABLE MONEDA;
DROP TABLE PAIS;
DROP TABLE CONTINENTE;
DROP TABLE CONTINENTE_X_MONEDA;
--Creacion de tablas

CREATE TABLE CONTINENTE (
	COD_CONTINENTE 	NUMBER(2,0) PRIMARY KEY ,
  DESCRIPCION 		VARCHAR2(50)  NOT NULL UNIQUE
);

CREATE TABLE PAIS(
	COD_CONTINENTE	NUMBER(2,0) ,
  COD_PAIS 				NUMBER(3,0) ,
  NOMBRE 					VARCHAR2(50) NOT NULL UNIQUE ,
  FOREIGN KEY (COD_CONTINENTE) REFERENCES CONTINENTE,
  PRIMARY KEY(COD_CONTINENTE,COD_PAIS)
);

CREATE TABLE MONEDA(
	ID_MONEDA				NUMBER(2,0) PRIMARY KEY,
  NOMBRE					VARCHAR2(50) NOT NULL UNIQUE
);

CREATE TABLE MONEDA_X_PAIS(
  ID_MONEDA				NUMBER(2,0) ,
  COD_CONTINENTE	NUMBER(2,0) ,
  ID_PAIS					NUMBER(3,0) ,
  FOREIGN KEY (ID_MONEDA) REFERENCES MONEDA,
  FOREIGN KEY (COD_CONTINENTE,ID_PAIS) REFERENCES PAIS,
  PRIMARY KEY (ID_MONEDA,COD_CONTINENTE,ID_PAIS)
);

CREATE TABLE TASAS (
	ID_MONEDA_ORIGEN	NUMBER(2,0) ,
	ID_MONEDA_DESTINO	NUMBER(2,0) ,
  FECHA							DATE 				,
  TASA_CAMBIO				NUMBER (6,2),
  FOREIGN KEY (ID_MONEDA_ORIGEN) REFERENCES MONEDA,
  FOREIGN KEY (ID_MONEDA_DESTINO) REFERENCES MONEDA,
  CONSTRAINT TCNV CHECK( TASA_CAMBIO >= 00000000000),
  PRIMARY KEY (ID_MONEDA_ORIGEN,ID_MONEDA_DESTINO,FECHA)
);

-- INSERTAR TUPLAS
--CONTINENTES
INSERT INTO CONTINENTE VALUES (0,'AMERICA');
INSERT INTO CONTINENTE VALUES (1,'EUROPA');
INSERT INTO CONTINENTE VALUES (2,'ASIA');
INSERT INTO CONTINENTE VALUES (3,'AFRICA');
INSERT INTO CONTINENTE VALUES (4,'OCEANIA');

--PAISES

INSERT INTO PAIS VALUES(0,0,'COLOMBIA');
INSERT INTO PAIS VALUES(0,1,'ESTADOS UNIDOS');
INSERT INTO PAIS VALUES(0,2,'MEXICO');
INSERT INTO PAIS VALUES(0,3,'CANADA');
INSERT INTO PAIS VALUES(1,4,'HOLANDA');
INSERT INTO PAIS VALUES(1,5,'ALEMANIA');
INSERT INTO PAIS VALUES(1,6,'FRANCIA');
INSERT INTO PAIS VALUES(2,7,'CHINA');
INSERT INTO PAIS VALUES(2,8,'INDIA');
INSERT INTO PAIS VALUES(2,9,'JAPON');
INSERT INTO PAIS VALUES(3,10,'EGIPTO');
INSERT INTO PAIS VALUES(3,11,'SUDAFRICA');
INSERT INTO PAIS VALUES(3,12,'GHANA');
INSERT INTO PAIS VALUES(4,13,'AUSTRALIA');
INSERT INTO PAIS VALUES(4,14,'NUEVA ZELANDA');
INSERT INTO PAIS VALUES(4,15,'MICRONESIA');

--MONEDAS

INSERT INTO MONEDA VALUES (0,'PESO COLOMBIANO') ;
INSERT INTO MONEDA VALUES (1,'EURO') ;
INSERT INTO MONEDA VALUES (2,'DOLAR') ;
INSERT INTO MONEDA VALUES (3,'YEN') ;
INSERT INTO MONEDA VALUES (4,'PESO MEXICANO');
INSERT INTO MONEDA VALUES (5,'DOLAR CANADIENSE');
INSERT INTO MONEDA VALUES (6,'DOLAR AUSTRALEANO');
INSERT INTO MONEDA VALUES (7,'RENMINBI');
INSERT INTO MONEDA VALUES (8,'RUPIA');
INSERT INTO MONEDA VALUES (9,'LIBRA EGIPCIA');
INSERT INTO MONEDA VALUES (10,'RAND SUDAFRICANO');
INSERT INTO MONEDA VALUES (11,'CEDI');
INSERT INTO MONEDA VALUES (12,'DOLAR NEOZELANDES');

--MONEDA_X_PAIS

INSERT INTO MONEDA_X_PAIS VALUES (0,0,1);
INSERT INTO MONEDA_X_PAIS VALUES (1,1,4);
INSERT INTO MONEDA_X_PAIS VALUES (1,1,5);
INSERT INTO MONEDA_X_PAIS VALUES (1,1,6);
INSERT INTO MONEDA_X_PAIS VALUES (2,0,1);
INSERT INTO MONEDA_X_PAIS VALUES (3,2,9);
INSERT INTO MONEDA_X_PAIS VALUES (4,0,2);
INSERT INTO MONEDA_X_PAIS VALUES (5,0,3);
INSERT INTO MONEDA_X_PAIS VALUES (6,4,13);
INSERT INTO MONEDA_X_PAIS VALUES (7,2,7);
INSERT INTO MONEDA_X_PAIS VALUES (8,2,8);
INSERT INTO MONEDA_X_PAIS VALUES (9,3,10);
INSERT INTO MONEDA_X_PAIS VALUES (10,3,11);
INSERT INTO MONEDA_X_PAIS VALUES (11,3,12);
INSERT INTO MONEDA_X_PAIS VALUES (12,4,14);
INSERT INTO MONEDA_X_PAIS VALUES (2,4,15);


--TASAS
COMMIT;


-- CONSULTAS

/*Produzca la siguiente tabla de cantidad de monedas por continente*/

CREATE TABLE CONTINENTE_X_MONEDA(
	MONEDA VARCHAR2(50),
  AMERICA NUMBER(2,0),
  ASIA NUMBER(2,0),
  OSEANIA NUMBER(2,0),
  AFRICA NUMBER(2,0),
  EUROPA NUMBER(2,0),
	TOTAL NUMBER(2,0)
);

INSERT INTO CONTINENTE_X_MONEDA  
  SELECT MM.NOMBRE AS MONEDA,  
														 (SELECT COUNT(DISTINCT ID_PAIS)
                                             FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                             WHERE COD_CONTINENTE = 0  AND MONEDA.ID_MONEDA= MM.ID_MONEDA
                            )AS AMERICA ,
                             (SELECT COUNT(DISTINCT ID_PAIS)
                                             FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                             WHERE COD_CONTINENTE = 2  AND MONEDA.ID_MONEDA= MM.ID_MONEDA
                                            )AS ASIA ,
                             (SELECT COUNT(DISTINCT ID_PAIS)
                                             FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                             WHERE COD_CONTINENTE = 4  AND MONEDA.ID_MONEDA= MM.ID_MONEDA
                                            ) AS OCEANIA ,    
                              (SELECT COUNT(DISTINCT ID_PAIS)
                                             FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                             WHERE COD_CONTINENTE = 3  AND MONEDA.ID_MONEDA= MM.ID_MONEDA
                                            ) AS AFRICA,
                              (SELECT COUNT(DISTINCT ID_PAIS)
                                             FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                             WHERE COD_CONTINENTE = 1  AND MONEDA.ID_MONEDA= MM.ID_MONEDA
                                            ) AS EUROPA,
                               (SELECT COUNT(DISTINCT ID_PAIS)
                                             FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                             WHERE  MONEDA.ID_MONEDA= MM.ID_MONEDA) AS TOTAL

FROM MONEDA MM;


INSERT INTO CONTINENTE_X_MONEDA VALUES('TOTAL',(sELECT COUNT(DISTINCT ID_PAIS)
                                               FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                               WHERE COD_CONTINENTE = 0 ),
                                               
                                               (sELECT COUNT(DISTINCT ID_PAIS)
                                               FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                               WHERE COD_CONTINENTE = 2 )
                                               ,
                                               (sELECT COUNT(DISTINCT ID_PAIS)
                                               FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                               WHERE COD_CONTINENTE = 4 ),
                                               
                                               (sELECT COUNT(DISTINCT ID_PAIS)
                                               FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                               WHERE COD_CONTINENTE = 3 ),
                                               
                                               (sELECT COUNT(DISTINCT ID_PAIS)
                                               FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA
                                               WHERE COD_CONTINENTE = 1 ),
                                               
                                                (sELECT COUNT(DISTINCT ID_PAIS)
                                               FROM MONEDA LEFT OUTER JOIN MONEDA_X_PAIS ON MONEDA.ID_MONEDA =MONEDA_X_PAIS.ID_MONEDA )
                                               );
                                               
                                    SELECT * FROM CONTINENTE_X_MONEDA;
COMMIT;